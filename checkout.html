<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/checkout.css">
    <title>Checkout</title>
</head>

<body>
    <!-- Banner image for checkout page -->
    <img src="assets/img/logotipos/BannerCheckout.png" class="bannercheckout">
    
    <section class="checkout-section">
        <div class="container">
            <h1>Checkout</h1>
            <div class="checkout-container">
                <!-- Left Column: User Information and Payment Details -->
                <div class="checkout-left">
                    <!-- Personal Information Section -->
                    <div class="form-section">
                        <h2>Tu informacion</h2>
                        <input type="email" placeholder="Correo Electronico" id="email" required>
                        <input type="text" placeholder="Nombre Completo" id="fullName" required>
                        <input type="tel" placeholder="Telefono" id="phone" required>
                    </div>

                    <!-- Delivery Address Section -->
                    <div class="form-section">
                        <h2>Direccion de Entrega</h2>
                        <input type="text" placeholder="Direccion de la calle" id="streetAddress" required>
                        <input type="text" placeholder="City" id="Cuidad" required>
                        <input type="text" placeholder="Estado/Provincia" id="state" required>
                        <input type="text" placeholder="ZIP/Codigo Postal" id="zipCode" required>
                        <select>
                            <option value="Espana">Espa√±a</option>
                            <option value="Italia">Italia</option>
                            <option value="Alemania">Alemania</option>
                        </select>
                    </div>
                    
                    <!-- Shipping Method Section -->
                    <div class="form-section">
                        <h2>Metodo de Entrega</h2>
                        <select id="shippingMethod" required>
                            <option value="standard">Envio standard (2-3 days) - Gratis</option>
                        </select>
                    </div>

                    <!-- Payment Method Section -->
                    <div class="form-section">
                        <h2>Metodo de Pago</h2>
                        <select id="paymentMethod" required>
                            <option value="creditCard">Credit Card</option>
                        </select>

                        <!-- Credit Card Input Fields -->
                        <div id="creditCardDetails" class="payment-details">
                            <input type="text" placeholder="Numero de Tarjeta - xxxx xxxx xxxx xxxx" id="cardNumber" required>
                            <input type="text" placeholder="Dia de expiracion (MM/AA)" id="expirationDate" required>
                            <input type="number" placeholder="CVV" id="cvv" maxlength="3" required>
                        </div>
                    </div>

                    <!-- Checkout Button -->
                    <div class="form-section">
                        <button class="checkout-button" onclick="confirmCheckout()">Confirm Checkout</button>
                    </div>
                </div>

                <!-- Right Column: Order Summary -->
                <div class="checkout-right">
                    <h2>Order Summary</h2>
                    <!-- Dynamic cart items will be inserted here -->
                    <div id="checkoutCartItems"></div>
                    
                    <!-- Subtotal and Total Sections -->
                    <div class="summary-item">
                        <p>Subtotal</p>
                        <p id="subtotal">$0.00</p>
                    </div>
                    <div class="summary-item">
                        <p>Total</p>
                        <p id="totalPrice">$0.00</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
    
// Consigue los items del carrito desde el browser storage
    function fetchCartData() {

        // Obtiene los datos los items del carrito desde el localStorage
        const cartData = JSON.parse(localStorage.getItem('cartData')) || [];

        // Muestra los items del carrito importados desde el localStorage en la pagina
        renderCheckoutItem('cartData')
    }

   // Crear un HTML para mostrar los items del carrito
    function renderCheckoutItems(cartData) {
        let checkoutItemsHTML = ''; // Guarda el HTML para los items del carrito
        let subtotal = 0; // Precio total de la calculacion

        // Loop de cada item en el carrito
        cartData.forEach(item => {
            // Genera el HTML de cada item del carrito
            checkoutItemsHTML += `
                <div class="checkout-item">
                    <div class="product-details">
                        <img src="${item.image}" alt="${item.name}" class="product-image">
                        <div class="product-info">
                            <p class="item-name">${item.name}</p>
                            <p>Price: $${item.price.toFixed(2)}</p>
                            <p>Quantity: ${item.quantity}</p>
                        </div>
                    </div>
                    <p class="item-total">$${(item.price * item.quantity).toFixed(2)}</p>
                </div>`;
            
            // Calcula el subtotal
            subtotal += item.price * item.quantity;
        });

        // Actualiza la pagina con los items del carrito y el total
        document.getElementById('checkoutCartItems').innerHTML = checkoutItemsHTML;
        document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
        document.getElementById('totalPrice').textContent = `$${subtotal.toFixed(2)}`;
    }

    // Validar el proceso del checkout
    function confirmCheckout() {
        // Colecta los valores del input
        const email = document.getElementById('email').value.trim();
        const fullName = document.getElementById('fullName').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const streetAddress = document.getElementById('streetAddress').value.trim();
        const city = document.getElementById('Cuidad').value.trim();
        const state = document.getElementById('state').value.trim();
        const zipCode = document.getElementById('zipCode').value.trim();
        const paymentMethod = document.getElementById('paymentMethod').value;

        // Valida que todos los campos completos
        if (!email || !fullName || !phone || !streetAddress || !city || !state || !zipCode || !paymentMethod) {
            alert("Please fill in all required fields.");
            return;
        }

        // Validacion adicional para las tarjetas de credit
        if (paymentMethod === 'creditCard') {
            const cardNumber = document.getElementById('cardNumber').value.trim();
            const expirationDate = document.getElementById('expirationDate').value.trim();
            const cvv = document.getElementById('cvv').value.trim();
            if (!cardNumber || !expirationDate || !cvv) {
                alert("Please fill in credit card details.");
                return;
            }
        }

        // Procede la confirmacion y se va a la pagina de confirmacion
        alert("Checkout confirmed! Proceeding to payment...");
        window.location.href = "confirmation.html";
    }

    // Load cart data when page opens
    fetchCartData();
    </script>
</body>
</html>
